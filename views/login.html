<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    :root{--lav:#F4E9FF; --purple:#6F2DBD; --purple2:#8E44AD;}
    body{background: var(--lav);}
    .card{border:0; border-radius:18px; box-shadow:0 10px 30px rgba(111,45,189,.15);}
    .btn-purple{background:var(--purple); border:0;}
    .btn-purple:hover{background:var(--purple2);}
    .brand{color:var(--purple); font-weight:800; letter-spacing:.3px;}
    .soft-input{border-radius:14px; border:1px solid rgba(111,45,189,.25);}
    .soft-input:focus{border-color:var(--purple); box-shadow:0 0 0 .2rem rgba(111,45,189,.15);}
  </style>
</head>

<body>
    <div class="container mt-5" style="max-width:520px;">
    <div class="text-center mb-3 brand" style="font-size:26px;">Chat Server</div>
    <div class="card p-4">
    <h4 class="mb-3" style="color:var(--purple);">Login</h4>

    <input id="username" class="form-control soft-input mb-2" placeholder="Username">
    <input id="password" type="password" class="form-control soft-input mb-3" placeholder="Password">

    <button id="btn" class="btn btn-purple text-white w-100">Login</button>
    <div id="msg" class="text-danger mt-3"></div>

    <a class="mt-3 d-block" href="/views/signup.html" style="color:var(--purple);">New user? Signup</a>
  </div>
</div>

<script>
document.getElementById("btn").onclick = async () => {
    msg.innerText = "";
    const res = await fetch("/api/login", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ username: username.value.trim(), password: password.value })
  });
  const data = await res.json();
  if (!res.ok) return msg.innerText = data.message || "Login failed";
  
  localStorage.setItem("token", data.token);
  localStorage.setItem("username", data.user.username);
  window.location.href = "/views/rooms.html";
};
</script>
</body>
</html>